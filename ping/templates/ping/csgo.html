<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ game.title }}</title>
    <style>
        /* Add styling for the page and ping results */
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .ping-result {
            font-size: 16px;
            color: #555;
        }
        .ping-success {
            color: green;
        }
        .ping-failure {
            color: red;
        }
    </style>
</head>
<body>
    <h1>{{ game.title }}</h1>
    <p>{{ game.article }}</p>

    <h2>Server Pings</h2>
    <ul id="server-list">
        {% for server, url in game.servers.items %}
        <li data-url="{{ url }}">{{ server }}: <span class="ping-result" id="ping-{{ forloop.counter }}">Pinging...</span></li>
        {% endfor %}
    </ul>

    <a href="/">Back to Home</a>

    <script>
        // Function to ping a server and display the latency
        async function pingServer(url, element) {
            const start = Date.now();
            try {
                await fetch(url, { method: 'HEAD', cache: 'no-store' });
                const latency = Date.now() - start;
                element.textContent = `${latency} ms`;
                element.classList.add('ping-success');
            } catch (error) {
                console.error(`Error pinging ${url}:`, error);
                element.textContent = 'Timed out';
                element.classList.add('ping-failure');
            }
        }

        // Ping all servers listed on the page
        function pingAllServers() {
            const serverItems = document.querySelectorAll('#server-list li');
            serverItems.forEach(item => {
                const url = item.getAttribute('data-url');
                const resultElement = item.querySelector('.ping-result');
                pingServer(url, resultElement);
            });
        }
        function refreshLatency() {
            const servers = document.querySelectorAll('#server-list li');
            servers.forEach((server, index) => {
                const ip = server.getAttribute('data-url');
                const resultElement = document.getElementById(`ping-${index + 1}`);
                pingServer(ip, resultElement);
            });
        }

        // Start pinging servers when the page loads
        window.onload = () => {
            refreshLatency(); // Fetch initial latency
            setInterval(refreshLatency, 3000); // Refresh every 3 seconds
        };
    </script>   
</body>
</html>